(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const v=document.querySelector("#popup-rules"),C=document.querySelector("#close-rules"),H=document.querySelector("#show-rules");H&&H.addEventListener("click",()=>{v.classList.remove("hidden")});C&&C.addEventListener("click",()=>{v.classList.add("hidden")});v&&v.addEventListener("click",c=>{c.target===v&&v.classList.add("hidden")});window.addEventListener("DOMContentLoaded",()=>{let c=document.getElementById("popup-overlay");c&&(c.classList.add("hidden"),c.innerHTML="")});function O(c){let e=document.getElementById("popup-overlay");e||(e=document.createElement("div"),e.id="popup-overlay",e.className="hidden",document.body.appendChild(e)),e.classList.remove("hidden"),e.innerHTML=`
    <div class="popup">
      <h2>${c} wins!</h2>
      <span id="close-popup">&times;</span>
    </div>
  `,e.onclick=t=>{const n=t.target;n&&n.id==="close-popup"&&(e.classList.add("hidden"),window.location.reload())}}class _{pieces=[];addPiece(e,t){e.position=t,this.pieces.push(e)}isEmpty(e){return!this.pieces.some(t=>t.position.q===e.q&&t.position.r===e.r)}neighbors(e){return[{q:1,r:0},{q:-1,r:0},{q:0,r:1},{q:0,r:-1},{q:1,r:-1},{q:-1,r:1}].map(n=>({q:e.q+n.q,r:e.r+n.r}))}isHiveIntact(e,t){if(this.pieces.length<=1)return!0;const n=this.pieces.filter(i=>i!==e&&i.owner===t&&!(i.type==="beetle"&&this.stackHeight(i.position)>1)).map(i=>`${i.position.q},${i.position.r}`);if(n.length===0)return!0;const o=new Set,s=[n[0]];for(;s.length>0;){const i=s.pop();if(o.has(i))continue;o.add(i);const[r,l]=i.split(",").map(Number);this.neighbors({q:r,r:l}).forEach(d=>{const m=`${d.q},${d.r}`;n.includes(m)&&!o.has(m)&&s.push(m)})}return o.size===n.length}stackHeight(e){return this.pieces.filter(t=>t.position.q===e.q&&t.position.r===e.r).length}getStackAt(e){return this.pieces.filter(t=>t.position.q===e.q&&t.position.r===e.r).sort((t,n)=>t.stackLevel-n.stackLevel)}updateStackLevelsAt(e){return this.getStackAt(e).length}directions(){return[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}]}addDir(e,t){return{q:e.q+t.q,r:e.r+t.r}}}class q{owner;position;stackLevel=0;constructor(e,t){this.owner=e,this.position=t}}O("White");class A{board;currentPlayer;turnCount;constructor(){this.board=new _,this.currentPlayer="White",this.turnCount=1}nextTurn(){this.currentPlayer=this.currentPlayer==="White"?"Black":"White",this.turnCount++}placePiece(e,t){if(console.log("placePiece",t.q,t.r),e.owner!==this.currentPlayer||!this.board.isEmpty(t))return!1;if(this.board.pieces.length===0)return this.board.addPiece(e,t),!0;const n=this.board.neighbors(t);let o=!1;for(const r of n){const l=this.board.pieces.find(d=>d.position.q===r.q&&d.position.r===r.r);if(l)if(l.owner===this.currentPlayer)o=!0;else return!1}if(this.board.pieces.length>1&&!o)return!1;const s=this.board.pieces.filter(r=>r.owner===e.owner);return!s.some(r=>r.constructor.name==="QueenBee")&&s.length>=3&&e.constructor.name!=="QueenBee"?!1:(this.board.addPiece(e,t),this.board.updateStackLevelsAt(t),!0)}movePiece(e,t){if(e.owner!==this.currentPlayer)return!1;const n=e.legalMoves(this.board);return n.some(s=>s.q===t.q&&s.r===t.r)?(this.board.pieces.length>2&&(e.position=t),e.position=t,e.stackLevel=this.board.updateStackLevelsAt(t),!0):(console.log("Move failed: Not a legal move"),console.log("Legal moves:",n),console.log("Attempted move to:",t),!1)}checkWin(){const e=this.board.pieces.filter(t=>t.constructor.name==="QueenBee");for(const t of e)if(this.board.neighbors(t.position).every(s=>!this.board.isEmpty(s)))return t.owner==="White"?"Black":"White";return null}}const $={};function R(c,e){const t=`${c}_${e}`;if(!$[t]){const n=new Image;n.src=`./src/assets/${c}_${e.toLowerCase()}.png`,$[t]=n}return $[t]}function Y(c,e){c.forEach(t=>{const n=R(t.type,t.color);e.drawImage(n,t.x,t.y,t.width,t.height)})}function W(c,e,t,n){const s=e/t-n-20,i=60,r=n+10;let l=i,d=i;const m=["bee","spider","beetle","hopper","ant"],N=c.filter(u=>u.color==="Black").sort((u,E)=>m.indexOf(u.type)-m.indexOf(E.type)),X=c.filter(u=>u.color==="White").sort((u,E)=>m.indexOf(u.type)-m.indexOf(E.type));N.forEach(u=>{u.x=20,u.y=l,l+=r}),X.forEach(u=>{u.x=s,u.y=d,d+=r})}function I(c,e,t){const n=(Math.sqrt(3)/3*c-.3333333333333333*e)/t,o=2/3*e/t;return z({q:n,r:o})}function z({q:c,r:e}){const t=-c-e;let n=Math.round(c),o=Math.round(e),s=Math.round(t);const i=Math.abs(n-c),r=Math.abs(o-e),l=Math.abs(s-t);return i>r&&i>l?n=-o-s:r>l&&(o=-n-s),{q:n,r:o}}function Q(c,e,t){const n=c.neighbors(e),o=c.neighbors(t);return n.filter(s=>o.some(i=>i.q===s.q&&i.r===s.r))}function L(c,e,t){if(!c.isEmpty(t)||!c.neighbors(t).some(r=>!c.isEmpty(r)))return!1;const s=Q(c,e,t);return!(s.length===2&&s.every(r=>!c.isEmpty(r)))}function D(c,e){const t=e.getStackAt(c.position);return t.length>0&&t[t.length-1]===c}class K extends q{type="bee";legalMoves(e){const t=this.position,n=e.neighbors(t),o=[];for(const s of n)L(e,t,s)&&o.push(s);return o}}class j extends q{type="beetle";legalMoves(e){const t=e.neighbors(this.position),n=[];for(const o of t){const s=e.isEmpty(o),i=e.stackHeight(this.position)>1;s?(i||L(e,this.position,o))&&n.push(o):n.push(o)}return n}}class G extends q{type="spider";legalMoves(e){const t=[],n=new Set;n.add(`${this.position.q},${this.position.r}`);const o=(s,i)=>{if(i===3){t.push(s);return}for(const r of e.neighbors(s)){const l=`${r.q},${r.r}`;n.has(l)||e.isEmpty(r)&&L(e,s,r)&&(n.add(l),o(r,i+1),n.delete(l))}};return o(this.position,0),t}}class F extends q{type="hopper";legalMoves(e){const t=[];for(const n of e.directions()){let o=e.addDir(this.position,n),s=!1;for(;!e.isEmpty(o);)s=!0,o=e.addDir(o,n);s&&t.push(o)}return t}}class Z extends q{type="ant";legalMoves(e){const t=[],n=new Set;n.add(`${this.position.q},${this.position.r}`);const o=s=>{for(const i of e.neighbors(s)){const r=`${i.q},${i.r}`;n.has(r)||e.isEmpty(i)&&L(e,s,i)&&(n.add(r),t.push(i),o(i),n.delete(r))}};return o(this.position),t}}function J(c,e,t){switch(c){case"bee":return new K(e,t);case"beetle":return new j(e,t);case"spider":return new G(e,t);case"hopper":return new F(e,t);case"ant":return new Z(e,t);default:return null}}const B={};function S(c,e){const t=`${c}_${e}`;if(!B[t]){const n=new Image;n.src=`./src/assets/${c}_${e.toLowerCase()}.png`,B[t]=n}return B[t]}class U{ctx;width;height;size;constructor(e,t=30){this.ctx=e.getContext("2d"),this.width=e.width,this.height=e.height,this.size=t}clear(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore()}hexToPixel(e,t){const n=window.devicePixelRatio||1,o=this.width/n/2,s=this.height/n/2,i=Math.sqrt(3)*this.size*(e+t/2)+o,r=3/2*this.size*t+s;return{x:i,y:r}}drawBoard(e,t){for(let s=-6;s<=6;s++)for(let i=-6;i<=6;i++)if(Math.abs(s+i)<=6){const{x:r,y:l}=this.hexToPixel(s,i),d=t&&t.q===s&&t.r===i;this.drawHexCustom(r,l,this.size,d?"#ffe066":void 0)}const o=new Map;for(const s of e.pieces){const i=`${s.position.q},${s.position.r}`;o.has(i)||o.set(i,[]),o.get(i).push(s)}for(const s of o.values()){s.sort((i,r)=>i.stackLevel-r.stackLevel);for(const i of s)this.drawPiece(i)}}drawHexCustom(e,t,n,o="#ddd"){this.ctx.beginPath();for(let s=0;s<6;s++){const i=Math.PI/3*s+Math.PI/6,r=e+n*Math.cos(i),l=t+n*Math.sin(i);s===0?this.ctx.moveTo(r,l):this.ctx.lineTo(r,l)}this.ctx.closePath(),this.ctx.strokeStyle="#333",this.ctx.stroke(),this.ctx.fillStyle=o,this.ctx.fill()}drawPiece(e){const{q:t,r:n}=e.position,{x:o,y:s}=this.hexToPixel(t,n),i=this.size;let r=e.constructor.name.toLowerCase();r.includes("queen")?r="bee":r.includes("beetle")?r="beetle":r.includes("spider")?r="spider":r.includes("grass")?r="hopper":r.includes("ant")&&(r="ant");const l=S(r,e.owner);this.ctx.drawImage(l,o-i*.9,s-i*.9,i*1.8,i*1.8)}}let P=[],b={x:0,y:0},y=[],a=null;const h=document.getElementById("hive-canvas"),g=window.devicePixelRatio||1;h.width=1e3*g;h.height=750*g;h.style.width="1000px";h.style.height="750px";const w=new U(h);w.ctx.setTransform(g,0,0,g,0,0);const p=new A,V=[{type:"bee",count:1},{type:"spider",count:2},{type:"beetle",count:2},{type:"hopper",count:3},{type:"ant",count:3}],k=50,f=40/g;let ee=0;function te(){return`p_${ee++}`}function se(){y=[],["Black","White"].forEach(c=>{V.forEach(({type:e,count:t})=>{for(let n=0;n<t;n++)y.push({id:te(),x:0,y:0,type:e,color:c,width:k,height:k})})}),W(y,h.width,g,k)}let x=null;h.addEventListener("click",c=>{const{x:e,y:t}=T(c,h),n=h.width/(2*g),o=h.height/(2*g);if(!a){for(let i=y.length-1;i>=0;i--){const r=y[i];if(e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height){a={from:"bank",bankId:r.id,type:r.type,color:r.color};return}}const s=I(e-n,t-o,f);for(let i=p.board.pieces.length-1;i>=0;i--){const r=p.board.pieces[i];if(r.position.q===s.q&&r.position.r===s.r&&r.owner===p.currentPlayer&&D(r,p.board)){a={from:"board",ref:r},P=r.legalMoves(p.board),console.log("Selected from board:",a),console.log("Stack level:",a.ref.stackLevel),console.log("Type:",a.ref.type);return}}}if(a){const s=a,i=I(e-n,t-o,f);if(s.from==="bank"){const l=J(s.type,s.color,i);if(l&&p.placePiece(l,i)){const d=y.findIndex(m=>m.id===s.bankId);d!==-1&&(y.splice(d,1),W(y,h.width,g,k)),p.nextTurn()}}else s.from==="board"&&(p.movePiece(s.ref,i)?(console.log("Move successful"),p.nextTurn()):console.log("Move failed"));a=null,P=[],M(),document.getElementById("game-status").textContent=`Next move: ${p.currentPlayer}`;const r=p.checkWin();r&&(console.log(`Winner: ${r}`),O(r))}});h.addEventListener("mousemove",c=>{b=T(c,h);const{x:e,y:t}=T(c,h),n=h.width/(2*g),o=h.height/(2*g),s=I(e-n,t-o,f);(!x||x.q!==s.q||x.r!==s.r)&&(x=s,M())});h.addEventListener("mouseleave",()=>{x=null,M()});function ne(c,e,t){c.save(),c.fillStyle="rgba(0, 200, 0, 0.3)",e.forEach(n=>{const{x:o,y:s}=t.hexToPixel(n.q,n.r);c.beginPath();for(let i=0;i<6;i++){const r=Math.PI/180*(60*i-30),l=o+f*Math.cos(r),d=s+f*Math.sin(r);i===0?c.moveTo(l,d):c.lineTo(l,d)}c.closePath(),c.fill()}),c.restore()}function T(c,e){const t=e.getBoundingClientRect();return{x:c.clientX-t.left,y:c.clientY-t.top}}function M(){if(w.clear(),Y(y,w.ctx),w.drawBoard(p.board,x),a&&a.from==="bank"){const c=w.ctx;let e=a.type.toLowerCase();const t=S(e,a.color);c.drawImage(t,b.x-f,b.y-f,f*2,f*2)}else if(a&&a.from==="board"){const c=w.ctx,e=a.ref.type,t=a.ref.owner,n=S(e,t);c.drawImage(n,b.x-f,b.y-f,f*2,f*2)}P.length>0&&ne(w.ctx,P,w)}se();M();document.getElementById("game-container")?.classList.remove("hidden");document.body.classList.add("ready");
