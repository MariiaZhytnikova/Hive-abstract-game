var ie=Object.defineProperty;var se=(o,e,t)=>e in o?ie(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var p=(o,e,t)=>se(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const k=document.querySelector("#popup-rules"),D=document.querySelector("#close-rules"),X=document.querySelector("#show-rules");X&&X.addEventListener("click",()=>{k.classList.remove("hidden")});D&&D.addEventListener("click",()=>{k.classList.add("hidden")});k&&k.addEventListener("click",o=>{o.target===k&&k.classList.add("hidden")});window.addEventListener("DOMContentLoaded",()=>{let o=document.getElementById("popup-overlay");o&&(o.classList.add("hidden"),o.innerHTML="")});function re(o){let e=document.getElementById("popup-overlay");e||(e=document.createElement("div"),e.id="popup-overlay",e.className="hidden",document.body.appendChild(e)),e.classList.remove("hidden"),e.innerHTML=`
    <div class="popup">
      <h2>${o} wins!</h2>
      <span id="close-popup">&times;</span>
    </div>
  `,e.onclick=t=>{const n=t.target;n&&n.id==="close-popup"&&(e.classList.add("hidden"),window.location.reload())}}class N{constructor(){p(this,"pieces",[])}addPiece(e,t){e.position=t,this.pieces.push(e)}isEmpty(e){return!this.pieces.some(t=>t.position.q===e.q&&t.position.r===e.r)}neighbors(e){return[{q:1,r:0},{q:-1,r:0},{q:0,r:1},{q:0,r:-1},{q:1,r:-1},{q:-1,r:1}].map(n=>({q:e.q+n.q,r:e.r+n.r}))}isHiveIntact(e,t){if(this.pieces.length<=1)return!0;const n=new Map;for(const l of this.pieces){const f=`${l.position.q},${l.position.r}`;n.has(f)||n.set(f,[]),n.get(f).push(l)}const i=`${e.position.q},${e.position.r}`,s=`${t.q},${t.r}`;n.has(i)&&(n.set(i,n.get(i).filter(l=>l!==e)),n.get(i).length===0&&n.delete(i)),n.has(s)||n.set(s,[]),n.get(s).push(e);const r=Array.from(n.entries()).map(([l,f])=>({key:l,top:f[f.length-1]})).map(({key:l})=>l);if(r.length===0)return!0;const c=new Set,a=[r[0]];for(;a.length>0;){const l=a.pop();if(c.has(l))continue;c.add(l);const[f,d]=l.split(",").map(Number);this.neighbors({q:f,r:d}).forEach(h=>{const g=`${h.q},${h.r}`;r.includes(g)&&!c.has(g)&&a.push(g)})}return c.size===r.length}stackHeight(e){return this.pieces.filter(t=>t.position.q===e.q&&t.position.r===e.r).length}getStackAt(e){return this.pieces.filter(t=>t.position.q===e.q&&t.position.r===e.r).sort((t,n)=>t.stackLevel-n.stackLevel)}updateStackLevelsAt(e){return this.getStackAt(e).length}directions(){return[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}]}addDir(e,t){return{q:e.q+t.q,r:e.r+t.r}}allCoordsAroundHive(){const e=new Set;for(const t of this.pieces)if(this.topPieceAt(this,t.position))for(const i of this.neighbors(t.position))this.isEmpty(i)&&e.add(`${i.q},${i.r}`);return Array.from(e).map(t=>{const[n,i]=t.split(",").map(Number);return{q:n,r:i}})}isTopPiece(e,t){const n=t.getStackAt(e.position);return n.length>0&&n[n.length-1]===e}topPieceAt(e,t){const n=e.getStackAt(t);return!n||n.length===0?null:n[n.length-1]}clone(){const e=new N;return e.pieces=this.pieces.map(t=>t.clone()),e}}class I{constructor(e,t){p(this,"owner");p(this,"position");p(this,"stackLevel",0);this.owner=e,this.position=t}clone(){const e=this.constructor,t=new e(this.owner,{...this.position});return t.stackLevel=this.stackLevel,t.type=this.type,t}}function m(o){const e=document.getElementById("game-error");e&&(e.textContent=o,setTimeout(()=>{e.textContent=""},5e3))}const ce=[{type:"bee",count:1},{type:"spider",count:2},{type:"beetle",count:2},{type:"hopper",count:3},{type:"ant",count:3}];let le=0;function ae(){return`p_${le++}`}class _{constructor(){p(this,"bank",[]);p(this,"board");p(this,"currentPlayer");p(this,"validMoves",[]);p(this,"turnWhite",0);p(this,"turnBlack",0);p(this,"aiEnabled",!1);p(this,"aiPlays","Black");p(this,"isGameOver",!1);this.board=new N,this.currentPlayer=null,this.bank=this.createInitialBank()}createInitialBank(){const e=[];return["Black","White"].forEach(t=>{ce.forEach(({type:n,count:i})=>{for(let s=0;s<i;s++)e.push({id:ae(),x:0,y:0,type:n,color:t,width:0,height:0})})}),e}nextTurn(){this.currentPlayer==="White"?(this.turnWhite++,console.log("White finished move",this.turnWhite),this.currentPlayer="Black"):(this.turnBlack++,console.log("Black finished move: ",this.turnBlack),this.currentPlayer="White")}clone(){const e=new _;return e.currentPlayer=this.currentPlayer,e.turnWhite=this.turnWhite,e.turnBlack=this.turnBlack,e.aiEnabled=this.aiEnabled,e.aiPlays=this.aiPlays,e.bank=this.bank.map(t=>({...t})),e.board.pieces=this.board.pieces.map(t=>{const n=Object.create(Object.getPrototypeOf(t));return Object.assign(n,t,{position:{...t.position}}),n}),e}getTurnNumber(e){return e==="White"?this.turnWhite:this.turnBlack}placePiece(e,t){if(e.owner!==this.currentPlayer)return console.log("not your turn"),m("âŒ Not your turn!"),!1;if(!this.board.isEmpty(t))return!1;if(this.board.pieces.length===0)return this.board.addPiece(e,t),!0;if(this.board.pieces.length===1)return this.board.neighbors(t).some(f=>!this.board.isEmpty(f))?(this.board.addPiece(e,t),!0):(console.log("Move failed: Hive is not intact"),m("âŒ Hive is not intact!"),!1);const n=this.board.neighbors(t);let i=!1;for(const a of n){const l=this.board.topPieceAt(this.board,a);if(l)if(l.owner===this.currentPlayer)i=!0;else return console.log("Move failed: You can place pieces next to your own, not your opponentâ€™s."),m("âŒ Piece must touch your color only!"),!1}if(!i)return console.log("Move failed: hive is not intact"),m("âŒ Hive is not intact!"),!1;const r=this.board.pieces.filter(a=>a.owner===e.owner).some(a=>a.constructor.name==="QueenBee"||a.type==="bee"),c=this.currentPlayer==="White"?this.turnWhite:this.turnBlack;return!r&&c>=3&&e.constructor.name!=="QueenBee"&&e.type!=="bee"?(console.log("Move failed: Queen should be placed at 4 move"),m("âŒ The Queen Bee must be placed by turn 4!"),!1):(this.board.addPiece(e,t),this.board.updateStackLevelsAt(t),!0)}movePiece(e,t){if(e.owner!==this.currentPlayer)return!1;const i=this.board.pieces.filter(l=>l.owner===e.owner).some(l=>l.type==="bee"||l.constructor.name==="QueenBee"),s=this.currentPlayer==="White"?this.turnWhite:this.turnBlack;if(!i&&s>=3)return console.log("Move failed: Queen must be placed before moving on turn 4"),m("âŒ You must place your Queen Bee by your 4th turn!"),!1;const r=e.legalMoves(this.board);if(!r.some(l=>l.q===t.q&&l.r===t.r))return console.log("Move failed: Not a legal move"),console.log("Legal moves:",r),console.log("Attempted move to:",t),!1;const a={...e.position};return this.board.pieces.length>2&&!(e.type==="beetle"&&e.stackLevel===0)&&(e.position=t,!this.board.isHiveIntact(e,t))?(e.position=a,console.log("Move failed: Hive not intact"),m("âŒ Hive is not intact!"),!1):(e.position=t,e.stackLevel=this.board.updateStackLevelsAt(t),!0)}checkWin(){const e=this.board.pieces.filter(t=>{var n;return t.type==="bee"||((n=t.constructor)==null?void 0:n.name)==="QueenBee"});for(const t of e){const n=t.position,i=this.board.neighbors(n);let s=0;for(const r of i)this.board.topPieceAt(this.board,r)&&s++;if(s===6)return t.owner==="White"?"Black":"White"}return null}}const C={};function ue(o){const t=`/Hive-abstract-game/assets/${o}`;return console.log("Loading asset:",t),t}function fe(o,e){const t=`${o}_${e}`;if(!C[t]){const n=new Image;n.src=ue(`${o}_${e.toLowerCase()}.png`),C[t]=n}return C[t]}function he(o,e){o.forEach(t=>{const n=fe(t.type,t.color),{x:i,y:s,width:r,height:c}=t;n.complete&&n.naturalWidth>0&&e.drawImage(n,i,s,r,c)})}function U(o,e,t,n){const i=20*t,s=e-n*t-20*t,r=60*t,c=(n+10)*t;let a=r,l=r;const f=["bee","spider","beetle","hopper","ant"],d=o.filter(g=>g.color==="Black").sort((g,v)=>f.indexOf(g.type)-f.indexOf(v.type)),h=o.filter(g=>g.color==="White").sort((g,v)=>f.indexOf(g.type)-f.indexOf(v.type));d.forEach(g=>{g.x=i,g.y=a,g.width=n*t,g.height=n*t,a+=c}),h.forEach(g=>{g.x=s,g.y=l,g.width=n*t,g.height=n*t,l+=c})}function de(o,e,t){const n=o.neighbors(e),i=o.neighbors(t);return n.filter(s=>i.some(r=>r.q===s.q&&r.r===s.r))}function $(o,e,t){if(!o.isEmpty(t)||!o.neighbors(t).some(c=>!o.isEmpty(c)))return!1;const s=de(o,e,t);return!(s.length===2&&s.every(c=>!o.isEmpty(c)))}function z(o,e,t){if(o.pieces.length===0||o.pieces.length===1)return!0;if(t.filter(i=>i.color===e).length>0){const i=o.allCoordsAroundHive();for(const s of i){if(!o.isEmpty(s))continue;const r=o.neighbors(s).map(l=>o.topPieceAt(o,l)).filter(l=>l!=null);if(r.length===0)continue;const c=r.some(l=>l.owner===e),a=r.some(l=>l.owner!==e);if(c&&!a)return!0}}for(const i of o.pieces)if(i.owner===e&&o.isTopPiece(i,o)&&i.legalMoves(o).length>0)return!0;return!1}class pe extends I{constructor(){super(...arguments);p(this,"type","bee")}legalMoves(t){const n=this.position,i=t.neighbors(n),s=[];for(const r of i){if(!$(t,n,r))continue;t.isHiveIntact(this,r)&&s.push(r)}return s}}class ge extends I{constructor(){super(...arguments);p(this,"type","beetle")}legalMoves(t){const n=t.neighbors(this.position),i=[],s=t.stackHeight(this.position)>1;for(const r of n)t.isHiveIntact(this,r)&&(t.isEmpty(r)?(s||$(t,this.position,r))&&i.push(r):i.push(r));return i}}class ye extends I{constructor(){super(...arguments);p(this,"type","spider")}legalMoves(t){const n=[],i=new Set;i.add(`${this.position.q},${this.position.r}`);const s=(r,c)=>{if(c===3){n.push(r);return}for(const a of t.neighbors(r)){const l=`${a.q},${a.r}`;i.has(l)||t.isEmpty(a)&&$(t,r,a)&&t.isHiveIntact(this,a)&&(i.add(l),s(a,c+1),i.delete(l))}};return s(this.position,0),n}}class me extends I{constructor(){super(...arguments);p(this,"type","hopper")}legalMoves(t){const n=[];for(const i of t.directions()){let s=t.addDir(this.position,i),r=!1;for(;!t.isEmpty(s);)r=!0,s=t.addDir(s,i);if(r){if(!t.isHiveIntact(this,s))continue;n.push(s)}}return n}}class be extends I{constructor(){super(...arguments);p(this,"type","ant")}legalMoves(t){const n=[],i=new Set;i.add(`${this.position.q},${this.position.r}`);const s=r=>{for(const c of t.neighbors(r)){const a=`${c.q},${c.r}`;i.has(a)||t.isEmpty(c)&&$(t,r,c)&&t.isHiveIntact(this,c)&&(i.add(a),n.push(c),s(c),i.delete(a))}};return s(this.position),n}}function H(o,e,t){switch(o){case"bee":return new pe(e,t);case"beetle":return new ge(e,t);case"spider":return new ye(e,t);case"hopper":return new me(e,t);case"ant":return new be(e,t);default:return null}}function ve({q:o,r:e}){const t=-o-e;let n=Math.round(o),i=Math.round(e),s=Math.round(t);const r=Math.abs(n-o),c=Math.abs(i-e),a=Math.abs(s-t);return r>c&&r>a?n=-i-s:c>a&&(i=-n-s),{q:n,r:i}}const L={};function ke(o){const t=`/Hive-abstract-game/assets/${o}`;return console.log("Loading asset:",t),t}function V(o,e){const t=`${o}_${e}`;if(!L[t]){const n=new Image;n.src=ke(`${o}_${e.toLowerCase()}.png`),L[t]=n}return L[t]}class Pe{constructor(e,t=30){p(this,"ctx");p(this,"logicalWidth");p(this,"logicalHeight");p(this,"physicalWidth");p(this,"physicalHeight");p(this,"size");p(this,"cameraQ",0);p(this,"cameraR",0);this.ctx=e.getContext("2d");const n=window.devicePixelRatio||1;this.physicalWidth=e.width,this.physicalHeight=e.height,this.logicalWidth=e.width/n,this.logicalHeight=e.height/n,this.size=t}get width(){return this.logicalWidth}get height(){return this.logicalHeight}clear(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.physicalWidth,this.physicalHeight),this.ctx.restore()}hexToPixel(e,t){const n=this.logicalWidth/2,i=this.logicalHeight/2,s=e-this.cameraQ,r=t-this.cameraR,c=Math.sqrt(3)*this.size*(s+r/2)+n,a=3/2*this.size*r+i;return{x:c,y:a}}pixelToHex(e,t){const n=this.logicalWidth/2,i=this.logicalHeight/2,s=e-n,r=t-i,c=(Math.sqrt(3)/3*s-1/3*r)/this.size,a=2/3*r/this.size;return ve({q:c+this.cameraQ,r:a+this.cameraR})}hexToPixelStatic(e,t){const n=this.logicalWidth/2,i=this.logicalHeight/2,s=Math.sqrt(3)*this.size*(e+t/2)+n,r=3/2*this.size*t+i;return{x:s,y:r}}drawBoard(e,t){for(let s=-9;s<=9;s++)for(let r=-9;r<=9;r++)if(Math.abs(s+r)<=9){const{x:c,y:a}=this.hexToPixelStatic(s,r),l=s+this.cameraQ,f=r+this.cameraR,d=t&&t.q===l&&t.r===f;this.drawHexCustom(c,a,this.size,d?"#ffe066":void 0)}const i=new Map;for(const s of e.pieces){const r=`${s.position.q},${s.position.r}`;i.has(r)||i.set(r,[]),i.get(r).push(s)}for(const s of i.values()){s.sort((r,c)=>r.stackLevel-c.stackLevel);for(const r of s)this.drawPiece(r)}}drawHexCustom(e,t,n,i="#ddd"){this.ctx.beginPath();for(let s=0;s<6;s++){const r=Math.PI/3*s+Math.PI/6,c=e+n*Math.cos(r),a=t+n*Math.sin(r);s===0?this.ctx.moveTo(c,a):this.ctx.lineTo(c,a)}this.ctx.closePath(),this.ctx.strokeStyle="#333",this.ctx.stroke(),this.ctx.fillStyle=i,this.ctx.fill()}drawPiece(e){const{q:t,r:n}=e.position,{x:i,y:s}=this.hexToPixel(t,n),r=this.size,c=e.type||e.constructor.name.toLowerCase(),a=V(c,e.owner);a.complete&&a.naturalWidth>0&&this.ctx.drawImage(a,i-r*.9,s-r*.9,r*1.8,r*1.8)}}function we(o,e,t,n){const i=document.getElementById(o);if(!i)throw new Error(`Canvas #${o} not found`);const s=window.devicePixelRatio||1;i.width=e*s,i.height=t*s,i.style.width=e+"px",i.style.height=t+"px";const r=new Pe(i,n);return r.ctx.setTransform(s,0,0,s,0,0),{canvas:i,renderer:r,dpr:s}}function Me(o,e,t,n){o.save(),o.fillStyle="rgba(0, 200, 0, 0.3)";const i=new Set;e.filter(r=>{const c=`${r.q},${r.r}`;return i.has(c)?!1:(i.add(c),!0)}).forEach(r=>{const{x:c,y:a}=t.hexToPixel(r.q,r.r);o.beginPath();for(let l=0;l<6;l++){const f=Math.PI/180*(60*l-30),d=c+n*Math.cos(f),h=a+n*Math.sin(f);l===0?o.moveTo(d,h):o.lineTo(d,h)}o.closePath(),o.fill()}),o.restore()}function q(o,e,t,n,i,s,r,c){if(o.clear(),he(t,o.ctx),o.drawBoard(e,n),i){const a=o.ctx;let l,f;i.from==="bank"?(l=i.type,f=i.color):(l=i.ref.type,f=i.ref.owner);const d=V(l,f);d.complete&&d.naturalWidth>0&&a.drawImage(d,r.x-c,r.y-c,c*2,c*2)}s.length>0&&Me(o.ctx,s,o,c)}function G(o,e){const t=e.getBoundingClientRect(),n=o.clientX-t.left,i=o.clientY-t.top;return{x:n,y:i}}function xe(o,e,t,n){o.addEventListener("click",i=>{const{x:s,y:r}=G(i,o);for(let a=e.length-1;a>=0;a--){const l=e[a];if(s>=l.x&&s<=l.x+l.width&&r>=l.y&&r<=l.y+l.height){n.onBankClick(l);return}}const c=t.pixelToHex(s,r);n.onHexClick(c)}),o.addEventListener("mousemove",i=>{const{x:s,y:r}=G(i,o),c=t.pixelToHex(s,r);n.onHoverHex(c,{x:s,y:r})}),o.addEventListener("mouseleave",()=>{n.onHoverHex(null,{x:0,y:0})})}const Ie=250,qe=6;let Z=0;function Ee(o,e,t=2){if(Z=performance.now(),!o.currentPlayer||o.currentPlayer!==e)return null;const n=J(o,e);if(n.length===0)return null;const i=n.map(l=>({move:l,score:$e(o,l,e)})).sort((l,f)=>f.score-l.score),s=i[0];if(s.score>=1e5)return s.move;const r=i.slice(0,qe).map(l=>l.move);let c=null,a=-1/0;for(const l of r){const f=o.clone();T(f,l,e),S(f);const d=W(f,t-1,-1/0,1/0,!1,e);d>a&&(a=d,c=l)}return c}function W(o,e,t,n,i,s){if(performance.now()-Z>Ie)return j(o,s);const r=o.checkWin();if(r===s)return 1e5;if(r&&r!==s)return-1e5;if(e===0)return j(o,s);const c=o.currentPlayer,a=J(o,c);if(a.length===0)return i?-500:500;if(i){let l=-1/0;for(const f of a){const d=o.clone();T(d,f,c),S(d);const h=W(d,e-1,t,n,!1,s);if(l=Math.max(l,h),t=Math.max(t,l),t>=n)break}return l}else{let l=1/0;for(const f of a){const d=o.clone();T(d,f,c),S(d);const h=W(d,e-1,t,n,!0,s);if(l=Math.min(l,h),n=Math.min(n,l),t>=n)break}return l}}function j(o,e){const t=o.board,n=t.pieces,i=n.filter(h=>h.owner===e),s=n.filter(h=>h.owner!==e),r=i.filter(h=>t.isTopPiece(h,t)).reduce((h,g)=>h+g.legalMoves(t).length,0),c=s.filter(h=>t.isTopPiece(h,t)).reduce((h,g)=>h+g.legalMoves(t).length,0),a=n.find(h=>h.owner===e&&(h.type==="bee"||h.constructor.name==="QueenBee")),l=n.find(h=>h.owner!==e&&(h.type==="bee"||h.constructor.name==="QueenBee")),f=a?O(t,a.position):0,d=l?O(t,l.position):0;return 10*(i.length-s.length)+2*(r-c)+8*(d-f)}function B(o,e){const t=o.board,i=t.pieces.find(s=>s.owner===e&&(s.type==="bee"||s.constructor.name==="QueenBee"));return i?O(t,i.position):0}function Be(o){return o==="White"?"Black":"White"}function O(o,e){return o.neighbors(e).filter(n=>!o.isEmpty(n)).length}function Ae(o,e){const t=[],n=o.board,i=n.allCoordsAroundHive();for(const s of i){if(!n.isEmpty(s))continue;const r={pieceType:"bee",color:e,target:{...s}};Q(o,r)&&t.push({kind:"place",from:"bank",pieceType:"bee",color:e,target:{...s}})}return t}function Te(o,e){const t=o.getTurnNumber(e);return!o.board.pieces.some(i=>i.owner===e&&(i.type==="bee"||i.constructor.name==="QueenBee"))&&t>=3}function J(o,e){const t=[],n=o.board,i=o.bank,s=new Map;function r(c){return s.has(c)||s.set(c,c.legalMoves(n)),s.get(c)}if(Te(o,e))return Ae(o,e);for(const c of i){if(c.color!==e)continue;const a=n.allCoordsAroundHive();for(const l of a){if(!n.isEmpty(l))continue;if(n.pieces.length===1){Q(o,{pieceType:c.type,color:e,target:{...l}})&&t.push({kind:"place",from:"bank",pieceType:c.type,color:e,target:{...l}});continue}const f=n.neighbors(l);let d=!1,h=!1;for(const v of f){const E=n.topPieceAt(n,v);E&&(E.owner===e?d=!0:h=!0)}if(!d||h)continue;const g={pieceType:c.type,color:e,target:{...l}};Q(o,g)&&t.push({kind:"place",from:"bank",pieceType:c.type,color:e,target:{...l}})}}for(const c of n.pieces){if(c.owner!==e||!n.isTopPiece(c,n))continue;const a=r(c);for(const l of a)t.push({kind:"move",from:"board",pieceType:c.type,color:c.owner,fromCoord:{...c.position},to:{...l}})}return t}function $e(o,e,t){let n=0;const i=Be(t),s=B(o,t),r=B(o,i),c=A(o,t),a=A(o,i),l=o.clone();T(l,e,t);const f=B(l,t),d=B(l,i),h=A(l,t),g=A(l,i);if(f>s&&(n-=500),e.kind==="place"&&o.getTurnNumber(t)<=6&&(n+=120),f>=5&&(n-=5e3),f===4&&(n-=1500),d>r&&(n+=200),d>=6)return 1e5;d>=5&&(n+=5e3),r>=3&&d>r&&(n+=400),r>=4&&d>=r&&(n+=400),e.kind==="place"&&e.pieceType==="hopper"&&r>=2&&(n+=120),e.kind==="move"&&o.bank.some(Y=>Y.color===t)&&f===s&&d===r&&(n-=80),d===r&&f===s&&Math.abs(h-c)<1&&(n-=80);const E=h-c,oe=g-a;return n+=E*8,n-=oe*6,e.kind==="place"&&e.pieceType!=="bee"&&(o.getTurnNumber(t)<4?n+=30:n-=10),n+=Math.random()*2,n}function A(o,e){const t=o.board,n=t.pieces.filter(s=>s.owner===e);let i=0;for(const s of n)t.isTopPiece(s,t)&&(i+=s.legalMoves(t).length);return Math.min(i,20)}function Q(o,e){const t=o.clone(),n=H(e.pieceType,e.color,e.target);return n?(t.board.pieces.length===1,t.placePiece(n,e.target)):!1}function He(o,e){if(e.kind==="place"){const n=H(e.pieceType,e.color,e.target);if(!n)return;o.placePiece(n,e.target);const i=o.bank.findIndex(s=>s.type===e.pieceType&&s.color===e.color);i!==-1&&o.bank.splice(i,1);return}const t=o.board.pieces.find(n=>n.owner===e.color&&n.type===e.pieceType&&n.position.q===e.fromCoord.q&&n.position.r===e.fromCoord.r);t&&o.movePiece(t,e.to)}function T(o,e,t){if(e.kind==="place"){o.currentPlayer=t;const i=H(e.pieceType,e.color,e.target);if(!i||!o.placePiece(i,e.target))return;const r=o.bank.findIndex(c=>c.color===e.color&&c.type===e.pieceType);r!==-1&&o.bank.splice(r,1);return}o.currentPlayer=t;const n=o.board.pieces.find(i=>i.owner===e.color&&i.type===e.pieceType&&i.position.q===e.fromCoord.q&&i.position.r===e.fromCoord.r);n&&o.movePiece(n,e.to)}function S(o){if(!o.currentPlayer)return;const e=o.currentPlayer==="White"?"Black":"White";z(o.board,e,o.bank)&&o.nextTurn()}class Ce{constructor(e){p(this,"game");p(this,"isEnabled",!1);p(this,"aiPlays","Black");p(this,"onMoveComplete",null);this.game=e}enable(){this.isEnabled=!0,console.log("AI enabled!")}disable(){this.isEnabled=!1,console.log("AI disabled!")}toggle(){return this.isEnabled=!this.isEnabled,this.isEnabled}makeMoveIfNeeded(){if(this.game.isGameOver||!this.isEnabled||!this.game.currentPlayer||!this.game.aiPlays)return;console.log("ðŸ¤– AI thinking...");const e=Ee(this.game,this.aiPlays,2);if(!e){console.log("AI: no move found");return}console.log("ðŸ¤– AI selected move:",e),He(this.game,e),this.onMoveComplete&&this.onMoveComplete()}}const R=1e3,Le=750,x=25,ee=30,{canvas:We,renderer:b,dpr:te}=we("hive-canvas",R,Le,x),u=new _;U(u.bank,R,te,ee);let y=null,P={x:0,y:0};const w=new Ce(u);w.onMoveComplete=()=>F();localStorage.getItem("playAgainstAI")==="true"&&(w.enable(),u.aiEnabled=!0,u.aiPlays="Black",document.getElementById("play_against_ai").textContent="AI: ON",m("ðŸ¤– Playing against AI"));let M=null;function Oe(o){if((y==null?void 0:y.from)==="bank"){y=null,u.validMoves=[],m("âŒ Placement cancelled"),q(b,u.board,u.bank,M,y,u.validMoves,P,x);return}if(u.aiEnabled){if(u.currentPlayer===u.aiPlays){m("ðŸ¤– AI is thinking...");return}if(o.color===u.aiPlays){m(`ðŸ¤– You cannot play ${u.aiPlays}, AI controls it!`);return}}u.currentPlayer||(u.currentPlayer=o.color,console.log(`First player: ${u.currentPlayer}`),document.getElementById("game-status").textContent=`Game started â€” ${u.currentPlayer} moves first`),y={from:"bank",bankId:o.id,type:o.type,color:o.color},console.log(`Selected from bank: ${y.color}, ${y.type}`)}function Qe(o){if(u.aiEnabled&&u.currentPlayer===u.aiPlays){m("ðŸ¤– AI is thinking...");return}if(!y){const e=u.board.topPieceAt(u.board,o);if(u.aiEnabled&&e&&e.owner===u.aiPlays){m("ðŸ¤– You cannot move Black â€” AI plays Black!");return}if(e&&e.owner===u.currentPlayer){y={from:"board",ref:e},console.log(`Selected from board: ${e.owner}, ${e.type}`),u.validMoves=e.legalMoves(u.board);return}return}y.from==="bank"?Se(o):y.from==="board"&&Ne(o),y=null,u.validMoves=[],q(b,u.board,u.bank,M,y,u.validMoves,P,x)}function Se(o){const e=y;if(e.from==="bank"){const t=H(e.type,e.color,o);if(!t)return;if(u.placePiece(t,o)){const n=u.bank.findIndex(i=>i.id===e.bankId);n!==-1&&(u.bank.splice(n,1),U(u.bank,R,te,ee)),ne(u.board,b),F()}}}function Ne(o){if(!y||y.from!=="board")return;const e=y.ref;u.movePiece(e,o)&&(ne(u.board,b),F()),y=null,u.validMoves=[],q(b,u.board,u.bank,M,y,u.validMoves,P,x)}function F(){if(u.isGameOver)return;const o=u.currentPlayer==="White"?"Black":"White";console.log(`Now turn of: ${o}`),z(u.board,o,u.bank)?(console.log(`${o} has availible moves`),u.nextTurn()):(console.log(`${o} has no availible moves`),m(`âš ï¸ ${o} has no legal moves â€” turn skipped!`)),y=null,u.validMoves=[],document.getElementById("game-status").textContent=`Next move: ${u.currentPlayer}`,w.isEnabled&&u.currentPlayer===u.aiPlays&&setTimeout(()=>w.makeMoveIfNeeded(),200);const e=u.checkWin();e&&(u.isGameOver=!0,re(e))}function _e(o,e){M=o,P=e,q(b,u.board,u.bank,M,y,u.validMoves,P,x)}document.getElementById("play_against_ai").addEventListener("click",()=>{if(w.isEnabled){w.disable(),u.aiEnabled=!1,localStorage.removeItem("playAgainstAI"),document.getElementById("play_against_ai").textContent="AI: OFF",m("âŒ AI Disabled");return}localStorage.setItem("playAgainstAI","true"),m("ðŸ¤– AI Enabled â€” restarting gameâ€¦"),setTimeout(()=>{location.reload()},300)});const Re=7;function ne(o,e){let t=null,n=0;for(const i of o.pieces){const s=i.position.q-e.cameraQ,r=i.position.r-e.cameraR,c=Math.max(Math.abs(s),Math.abs(r));c>n&&(n=c,t=i.position)}t&&n>=Re&&(e.cameraQ+=Math.sign(t.q-e.cameraQ),e.cameraR+=Math.sign(t.r-e.cameraR))}q(b,u.board,u.bank,M,y,u.validMoves,P,x);var K;(K=document.getElementById("game-container"))==null||K.classList.remove("hidden");document.body.classList.add("ready");xe(We,u.bank,b,{onHexClick:Qe,onBankClick:Oe,onHoverHex:_e});
