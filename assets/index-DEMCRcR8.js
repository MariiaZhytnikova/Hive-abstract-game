var se=Object.defineProperty;var ie=(n,e,t)=>e in n?se(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var y=(n,e,t)=>ie(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const k=document.querySelector("#popup-rules"),X=document.querySelector("#close-rules"),D=document.querySelector("#show-rules");D&&D.addEventListener("click",()=>{k.classList.remove("hidden")});X&&X.addEventListener("click",()=>{k.classList.add("hidden")});k&&k.addEventListener("click",n=>{n.target===k&&k.classList.add("hidden")});window.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("popup-overlay");n&&(n.classList.add("hidden"),n.innerHTML="")});function re(n){let e=document.getElementById("popup-overlay");e||(e=document.createElement("div"),e.id="popup-overlay",e.className="hidden",document.body.appendChild(e)),e.classList.remove("hidden"),e.innerHTML=`
    <div class="popup">
      <h2>${n} wins!</h2>
      <span id="close-popup">&times;</span>
    </div>
  `,e.onclick=t=>{const o=t.target;o&&o.id==="close-popup"&&(e.classList.add("hidden"),window.location.reload())}}class N{constructor(){y(this,"pieces",[])}addPiece(e,t){e.position=t,this.pieces.push(e)}isEmpty(e){return!this.pieces.some(t=>t.position.q===e.q&&t.position.r===e.r)}neighbors(e){return[{q:1,r:0},{q:-1,r:0},{q:0,r:1},{q:0,r:-1},{q:1,r:-1},{q:-1,r:1}].map(o=>({q:e.q+o.q,r:e.r+o.r}))}isHiveIntact(e,t){if(this.pieces.length<=1)return!0;const o=new Map;for(const l of this.pieces){const f=`${l.position.q},${l.position.r}`;o.has(f)||o.set(f,[]),o.get(f).push(l)}const s=`${e.position.q},${e.position.r}`,i=`${t.q},${t.r}`;o.has(s)&&(o.set(s,o.get(s).filter(l=>l!==e)),o.get(s).length===0&&o.delete(s)),o.has(i)||o.set(i,[]),o.get(i).push(e);const r=Array.from(o.entries()).map(([l,f])=>({key:l,top:f[f.length-1]})).map(({key:l})=>l);if(r.length===0)return!0;const c=new Set,a=[r[0]];for(;a.length>0;){const l=a.pop();if(c.has(l))continue;c.add(l);const[f,d]=l.split(",").map(Number);this.neighbors({q:f,r:d}).forEach(h=>{const p=`${h.q},${h.r}`;r.includes(p)&&!c.has(p)&&a.push(p)})}return c.size===r.length}stackHeight(e){return this.pieces.filter(t=>t.position.q===e.q&&t.position.r===e.r).length}getStackAt(e){return this.pieces.filter(t=>t.position.q===e.q&&t.position.r===e.r).sort((t,o)=>t.stackLevel-o.stackLevel)}updateStackLevelsAt(e){return this.getStackAt(e).length}directions(){return[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}]}addDir(e,t){return{q:e.q+t.q,r:e.r+t.r}}allCoordsAroundHive(){const e=new Set;for(const t of this.pieces)if(this.topPieceAt(this,t.position))for(const s of this.neighbors(t.position))this.isEmpty(s)&&e.add(`${s.q},${s.r}`);return Array.from(e).map(t=>{const[o,s]=t.split(",").map(Number);return{q:o,r:s}})}isTopPiece(e,t){const o=t.getStackAt(e.position);return o.length>0&&o[o.length-1]===e}topPieceAt(e,t){const o=e.getStackAt(t);return!o||o.length===0?null:o[o.length-1]}clone(){const e=new N;return e.pieces=this.pieces.map(t=>t.clone()),e}}class x{constructor(e,t){y(this,"owner");y(this,"position");y(this,"stackLevel",0);this.owner=e,this.position=t}clone(){const e=this.constructor,t=new e(this.owner,{...this.position});return t.stackLevel=this.stackLevel,t.type=this.type,t}}function b(n){const e=document.getElementById("game-error");e&&(e.textContent=n,setTimeout(()=>{e.textContent=""},5e3))}const ce=[{type:"bee",count:1},{type:"spider",count:2},{type:"beetle",count:2},{type:"hopper",count:3},{type:"ant",count:3}];let le=0;function ae(){return`p_${le++}`}class _{constructor(){y(this,"bank",[]);y(this,"board");y(this,"currentPlayer");y(this,"validMoves",[]);y(this,"turnWhite",0);y(this,"turnBlack",0);y(this,"aiEnabled",!1);y(this,"aiPlays","Black");y(this,"isGameOver",!1);this.board=new N,this.currentPlayer=null,this.bank=this.createInitialBank()}createInitialBank(){const e=[];return["Black","White"].forEach(t=>{ce.forEach(({type:o,count:s})=>{for(let i=0;i<s;i++)e.push({id:ae(),x:0,y:0,type:o,color:t,width:0,height:0})})}),e}nextTurn(){this.currentPlayer==="White"?(this.turnWhite++,console.log("White finished move",this.turnWhite),this.currentPlayer="Black"):(this.turnBlack++,console.log("Black finished move: ",this.turnBlack),this.currentPlayer="White")}clone(){const e=new _;return e.currentPlayer=this.currentPlayer,e.turnWhite=this.turnWhite,e.turnBlack=this.turnBlack,e.aiEnabled=this.aiEnabled,e.aiPlays=this.aiPlays,e.bank=this.bank.map(t=>({...t})),e.board.pieces=this.board.pieces.map(t=>{const o=Object.create(Object.getPrototypeOf(t));return Object.assign(o,t,{position:{...t.position}}),o}),e}getTurnNumber(e){return e==="White"?this.turnWhite:this.turnBlack}placePiece(e,t){if(e.owner!==this.currentPlayer)return console.log("not your turn"),b("âŒ Not your turn!"),!1;if(!this.board.isEmpty(t))return!1;if(this.board.pieces.length===0)return this.board.addPiece(e,t),!0;if(this.board.pieces.length===1)return this.board.neighbors(t).some(f=>!this.board.isEmpty(f))?(this.board.addPiece(e,t),!0):(console.log("Move failed: Hive is not intact"),b("âŒ Hive is not intact!"),!1);const o=this.board.neighbors(t);let s=!1;for(const a of o){const l=this.board.topPieceAt(this.board,a);if(l)if(l.owner===this.currentPlayer)s=!0;else return console.log("Move failed: You can place pieces next to your own, not your opponentâ€™s."),b("âŒ Piece must touch your color only!"),!1}if(!s)return console.log("Move failed: hive is not intact"),b("âŒ Hive is not intact!"),!1;const r=this.board.pieces.filter(a=>a.owner===e.owner).some(a=>a.constructor.name==="QueenBee"||a.type==="bee"),c=this.currentPlayer==="White"?this.turnWhite:this.turnBlack;return!r&&c>=3&&e.constructor.name!=="QueenBee"&&e.type!=="bee"?(console.log("Move failed: Queen should be placed at 4 move"),b("âŒ The Queen Bee must be placed by turn 4!"),!1):(this.board.addPiece(e,t),this.board.updateStackLevelsAt(t),!0)}movePiece(e,t){if(e.owner!==this.currentPlayer)return!1;const s=this.board.pieces.filter(l=>l.owner===e.owner).some(l=>l.type==="bee"||l.constructor.name==="QueenBee"),i=this.currentPlayer==="White"?this.turnWhite:this.turnBlack;if(!s&&i>=3)return console.log("Move failed: Queen must be placed before moving on turn 4"),b("âŒ You must place your Queen Bee by your 4th turn!"),!1;const r=e.legalMoves(this.board);if(!r.some(l=>l.q===t.q&&l.r===t.r))return console.log("Move failed: Not a legal move"),console.log("Legal moves:",r),console.log("Attempted move to:",t),!1;const a={...e.position};return this.board.pieces.length>2&&!(e.type==="beetle"&&e.stackLevel===0)&&(e.position=t,!this.board.isHiveIntact(e,t))?(e.position=a,console.log("Move failed: Hive not intact"),b("âŒ Hive is not intact!"),!1):(e.position=t,e.stackLevel=this.board.updateStackLevelsAt(t),!0)}checkWin(){const e=this.board.pieces.filter(t=>{var o;return t.type==="bee"||((o=t.constructor)==null?void 0:o.name)==="QueenBee"});for(const t of e){const o=t.position,s=this.board.neighbors(o);let i=0;for(const r of s)this.board.topPieceAt(this.board,r)&&i++;if(i===6)return t.owner==="White"?"Black":"White"}return null}}const H={};function ue(n){const t=`/Hive-abstract-game/assets/${n}`;return console.log("Loading asset:",t),t}function fe(n,e){const t=`${n}_${e}`;if(!H[t]){const o=new Image;o.src=ue(`${n}_${e.toLowerCase()}.png`),H[t]=o}return H[t]}function he(n,e){n.forEach(t=>{const o=fe(t.type,t.color),{x:s,y:i,width:r,height:c}=t;o.complete&&o.naturalWidth>0&&e.drawImage(o,s,i,r,c)})}function V(n,e,t,o){const s=20*t,i=e-o*t-20*t,r=60*t,c=(o+10)*t;let a=r,l=r;const f=["bee","spider","beetle","hopper","ant"],d=n.filter(p=>p.color==="Black").sort((p,m)=>f.indexOf(p.type)-f.indexOf(m.type)),h=n.filter(p=>p.color==="White").sort((p,m)=>f.indexOf(p.type)-f.indexOf(m.type));d.forEach(p=>{p.x=s,p.y=a,p.width=o*t,p.height=o*t,a+=c}),h.forEach(p=>{p.x=i,p.y=l,p.width=o*t,p.height=o*t,l+=c})}function de(n,e,t){const o=n.neighbors(e),s=n.neighbors(t);return o.filter(i=>s.some(r=>r.q===i.q&&r.r===i.r))}function A(n,e,t){if(!n.isEmpty(t)||!n.neighbors(t).some(c=>!n.isEmpty(c)))return!1;const i=de(n,e,t);return!(i.length===2&&i.every(c=>!n.isEmpty(c)))}function J(n,e,t){if(n.pieces.length===0||n.pieces.length===1)return!0;if(t.filter(s=>s.color===e).length>0){const s=n.allCoordsAroundHive();for(const i of s){if(!n.isEmpty(i))continue;const r=n.neighbors(i).map(l=>n.topPieceAt(n,l)).filter(l=>l!=null);if(r.length===0)continue;const c=r.some(l=>l.owner===e),a=r.some(l=>l.owner!==e);if(c&&!a)return!0}}for(const s of n.pieces)if(s.owner===e&&n.isTopPiece(s,n)&&s.legalMoves(n).length>0)return!0;return!1}class pe extends x{constructor(){super(...arguments);y(this,"type","bee")}legalMoves(t){const o=this.position,s=t.neighbors(o),i=[];for(const r of s){if(!A(t,o,r))continue;t.isHiveIntact(this,r)&&i.push(r)}return i}}class ye extends x{constructor(){super(...arguments);y(this,"type","beetle")}legalMoves(t){const o=t.neighbors(this.position),s=[],i=t.stackHeight(this.position)>1;for(const r of o)t.isHiveIntact(this,r)&&(t.isEmpty(r)?(i||A(t,this.position,r))&&s.push(r):s.push(r));return s}}class ge extends x{constructor(){super(...arguments);y(this,"type","spider")}legalMoves(t){const o=[],s=new Set;s.add(`${this.position.q},${this.position.r}`);const i=(r,c)=>{if(c===3){o.push(r);return}for(const a of t.neighbors(r)){const l=`${a.q},${a.r}`;s.has(l)||t.isEmpty(a)&&A(t,r,a)&&t.isHiveIntact(this,a)&&(s.add(l),i(a,c+1),s.delete(l))}};return i(this.position,0),o}}class be extends x{constructor(){super(...arguments);y(this,"type","hopper")}legalMoves(t){const o=[];for(const i of t.directions()){let r=t.addDir(this.position,i),c=!1;for(;!t.isEmpty(r);)c=!0,r=t.addDir(r,i);if(c){if(Math.abs(r.q)>6||Math.abs(r.r)>6||Math.abs(r.q+r.r)>6||!t.isHiveIntact(this,r))continue;o.push(r)}}return o}}class me extends x{constructor(){super(...arguments);y(this,"type","ant")}legalMoves(t){const o=[],s=new Set;s.add(`${this.position.q},${this.position.r}`);const i=r=>{for(const c of t.neighbors(r)){const a=`${c.q},${c.r}`;s.has(a)||t.isEmpty(c)&&A(t,r,c)&&t.isHiveIntact(this,c)&&(s.add(a),o.push(c),i(c),s.delete(a))}};return i(this.position),o}}function T(n,e,t){switch(n){case"bee":return new pe(e,t);case"beetle":return new ye(e,t);case"spider":return new ge(e,t);case"hopper":return new be(e,t);case"ant":return new me(e,t);default:return null}}const L={};function ke(n){const t=`/Hive-abstract-game/assets/${n}`;return console.log("Loading asset:",t),t}function Z(n,e){const t=`${n}_${e}`;if(!L[t]){const o=new Image;o.src=ke(`${n}_${e.toLowerCase()}.png`),L[t]=o}return L[t]}class ve{constructor(e,t=30){y(this,"ctx");y(this,"logicalWidth");y(this,"logicalHeight");y(this,"physicalWidth");y(this,"physicalHeight");y(this,"size");this.ctx=e.getContext("2d");const o=window.devicePixelRatio||1;this.physicalWidth=e.width,this.physicalHeight=e.height,this.logicalWidth=e.width/o,this.logicalHeight=e.height/o,this.size=t}clear(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.physicalWidth,this.physicalHeight),this.ctx.restore()}hexToPixel(e,t){const o=this.logicalWidth/2,s=this.logicalHeight/2,i=Math.sqrt(3)*this.size*(e+t/2)+o,r=3/2*this.size*t+s;return{x:i,y:r}}drawBoard(e,t){for(let i=-6;i<=6;i++)for(let r=-6;r<=6;r++)if(Math.abs(i+r)<=6){const{x:c,y:a}=this.hexToPixel(i,r),l=t&&t.q===i&&t.r===r;this.drawHexCustom(c,a,this.size,l?"#ffe066":void 0)}const s=new Map;for(const i of e.pieces){const r=`${i.position.q},${i.position.r}`;s.has(r)||s.set(r,[]),s.get(r).push(i)}for(const i of s.values()){i.sort((r,c)=>r.stackLevel-c.stackLevel);for(const r of i)this.drawPiece(r)}}drawHexCustom(e,t,o,s="#ddd"){this.ctx.beginPath();for(let i=0;i<6;i++){const r=Math.PI/3*i+Math.PI/6,c=e+o*Math.cos(r),a=t+o*Math.sin(r);i===0?this.ctx.moveTo(c,a):this.ctx.lineTo(c,a)}this.ctx.closePath(),this.ctx.strokeStyle="#333",this.ctx.stroke(),this.ctx.fillStyle=s,this.ctx.fill()}drawPiece(e){const{q:t,r:o}=e.position,{x:s,y:i}=this.hexToPixel(t,o),r=this.size,c=e.type||e.constructor.name.toLowerCase(),a=Z(c,e.owner);a.complete&&a.naturalWidth>0&&this.ctx.drawImage(a,s-r*.9,i-r*.9,r*1.8,r*1.8)}}function Pe(n,e,t,o){const s=document.getElementById(n);if(!s)throw new Error(`Canvas #${n} not found`);const i=window.devicePixelRatio||1;s.width=e*i,s.height=t*i,s.style.width=e+"px",s.style.height=t+"px";const r=new ve(s,o);return r.ctx.setTransform(i,0,0,i,0,0),{canvas:s,renderer:r,dpr:i}}function we(n,e,t,o){n.save(),n.fillStyle="rgba(0, 200, 0, 0.3)";const s=new Set;e.filter(r=>{const c=`${r.q},${r.r}`;return s.has(c)?!1:(s.add(c),!0)}).forEach(r=>{const{x:c,y:a}=t.hexToPixel(r.q,r.r);n.beginPath();for(let l=0;l<6;l++){const f=Math.PI/180*(60*l-30),d=c+o*Math.cos(f),h=a+o*Math.sin(f);l===0?n.moveTo(d,h):n.lineTo(d,h)}n.closePath(),n.fill()}),n.restore()}function $(n,e,t,o,s,i,r,c){if(n.clear(),he(t,n.ctx),n.drawBoard(e,o),s){const a=n.ctx;let l,f;s.from==="bank"?(l=s.type,f=s.color):(l=s.ref.type,f=s.ref.owner);const d=Z(l,f);d.complete&&d.naturalWidth>0&&a.drawImage(d,r.x-c,r.y-c,c*2,c*2)}i.length>0&&we(n.ctx,i,n,c)}function G(n,e,t){const o=(Math.sqrt(3)/3*n-.3333333333333333*e)/t,s=2/3*e/t;return Me({q:o,r:s})}function Me({q:n,r:e}){const t=-n-e;let o=Math.round(n),s=Math.round(e),i=Math.round(t);const r=Math.abs(o-n),c=Math.abs(s-e),a=Math.abs(i-t);return r>c&&r>a?o=-s-i:c>a&&(s=-o-i),{q:o,r:s}}function j(n,e){const t=e.getBoundingClientRect(),o=n.clientX-t.left,s=n.clientY-t.top;return{x:o,y:s}}function xe(n,e,t,o){const s=n.clientWidth,i=n.clientHeight;n.addEventListener("click",r=>{const{x:c,y:a}=j(r,n),l=s/2,f=i/2;for(let h=e.length-1;h>=0;h--){const p=e[h];if(c>=p.x&&c<=p.x+p.width&&a>=p.y&&a<=p.y+p.height){o.onBankClick(p);return}}const d=G(c-l,a-f,t);o.onHexClick(d)}),n.addEventListener("mousemove",r=>{const{x:c,y:a}=j(r,n),l=s/2,f=i/2,d=G(c-l,a-f,t);o.onHoverHex(d,{x:c,y:a})}),n.addEventListener("mouseleave",()=>{o.onHoverHex(null,{x:0,y:0})})}const Ie=250,qe=6;let z=0;function Ee(n,e,t=2){if(z=performance.now(),!n.currentPlayer||n.currentPlayer!==e)return null;const o=ee(n,e);if(o.length===0)return null;const s=o.map(l=>({move:l,score:$e(n,l,e)})).sort((l,f)=>f.score-l.score),i=s[0];if(i.score>=1e5)return i.move;const r=s.slice(0,qe).map(l=>l.move);let c=null,a=-1/0;for(const l of r){const f=n.clone();B(f,l,e),Q(f);const d=W(f,t-1,-1/0,1/0,!1,e);d>a&&(a=d,c=l)}return c}function W(n,e,t,o,s,i){if(performance.now()-z>Ie)return K(n,i);const r=n.checkWin();if(r===i)return 1e5;if(r&&r!==i)return-1e5;if(e===0)return K(n,i);const c=n.currentPlayer,a=ee(n,c);if(a.length===0)return s?-500:500;if(s){let l=-1/0;for(const f of a){const d=n.clone();B(d,f,c),Q(d);const h=W(d,e-1,t,o,!1,i);if(l=Math.max(l,h),t=Math.max(t,l),t>=o)break}return l}else{let l=1/0;for(const f of a){const d=n.clone();B(d,f,c),Q(d);const h=W(d,e-1,t,o,!0,i);if(l=Math.min(l,h),o=Math.min(o,l),t>=o)break}return l}}function K(n,e){const t=n.board,o=t.pieces,s=o.filter(h=>h.owner===e),i=o.filter(h=>h.owner!==e),r=s.filter(h=>t.isTopPiece(h,t)).reduce((h,p)=>h+p.legalMoves(t).length,0),c=i.filter(h=>t.isTopPiece(h,t)).reduce((h,p)=>h+p.legalMoves(t).length,0),a=o.find(h=>h.owner===e&&(h.type==="bee"||h.constructor.name==="QueenBee")),l=o.find(h=>h.owner!==e&&(h.type==="bee"||h.constructor.name==="QueenBee")),f=a?O(t,a.position):0,d=l?O(t,l.position):0;return 10*(s.length-i.length)+2*(r-c)+8*(d-f)}function q(n,e){const t=n.board,s=t.pieces.find(i=>i.owner===e&&(i.type==="bee"||i.constructor.name==="QueenBee"));return s?O(t,s.position):0}function Be(n){return n==="White"?"Black":"White"}function O(n,e){return n.neighbors(e).filter(o=>!n.isEmpty(o)).length}function Ae(n,e){const t=[],o=n.board,s=o.allCoordsAroundHive();for(const i of s){if(!o.isEmpty(i))continue;const r={pieceType:"bee",color:e,target:{...i}};S(n,r)&&t.push({kind:"place",from:"bank",pieceType:"bee",color:e,target:{...i}})}return t}function Te(n,e){const t=n.getTurnNumber(e);return!n.board.pieces.some(s=>s.owner===e&&(s.type==="bee"||s.constructor.name==="QueenBee"))&&t>=3}function ee(n,e){const t=[],o=n.board,s=n.bank,i=new Map;function r(c){return i.has(c)||i.set(c,c.legalMoves(o)),i.get(c)}if(Te(n,e))return Ae(n,e);for(const c of s){if(c.color!==e)continue;const a=o.allCoordsAroundHive();for(const l of a){if(!o.isEmpty(l))continue;if(o.pieces.length===1){S(n,{pieceType:c.type,color:e,target:{...l}})&&t.push({kind:"place",from:"bank",pieceType:c.type,color:e,target:{...l}});continue}const f=o.neighbors(l);let d=!1,h=!1;for(const m of f){const I=o.topPieceAt(o,m);I&&(I.owner===e?d=!0:h=!0)}if(!d||h)continue;const p={pieceType:c.type,color:e,target:{...l}};S(n,p)&&t.push({kind:"place",from:"bank",pieceType:c.type,color:e,target:{...l}})}}for(const c of o.pieces){if(c.owner!==e||!o.isTopPiece(c,o))continue;const a=r(c);for(const l of a)t.push({kind:"move",from:"board",pieceType:c.type,color:c.owner,fromCoord:{...c.position},to:{...l}})}return t}function $e(n,e,t){let o=0;const s=Be(t),i=q(n,t),r=q(n,s),c=E(n,t),a=E(n,s),l=n.clone();B(l,e,t);const f=q(l,t),d=q(l,s),h=E(l,t),p=E(l,s);if(f>i&&(o-=500),e.kind==="place"&&n.getTurnNumber(t)<=6&&(o+=120),f>=5&&(o-=5e3),f===4&&(o-=1500),d>r&&(o+=200),d>=6)return 1e5;d>=5&&(o+=5e3),r>=3&&d>r&&(o+=400),r>=4&&d>=r&&(o+=400),e.kind==="place"&&e.pieceType==="hopper"&&r>=2&&(o+=120),e.kind==="move"&&n.bank.some(Y=>Y.color===t)&&f===i&&d===r&&(o-=80),d===r&&f===i&&Math.abs(h-c)<1&&(o-=80);const I=h-c,oe=p-a;return o+=I*8,o-=oe*6,e.kind==="place"&&e.pieceType!=="bee"&&(n.getTurnNumber(t)<4?o+=30:o-=10),o+=Math.random()*2,o}function E(n,e){const t=n.board,o=t.pieces.filter(i=>i.owner===e);let s=0;for(const i of o)t.isTopPiece(i,t)&&(s+=i.legalMoves(t).length);return Math.min(s,20)}function S(n,e){const t=n.clone(),o=T(e.pieceType,e.color,e.target);return o?(t.board.pieces.length===1,t.placePiece(o,e.target)):!1}function Ce(n,e){if(e.kind==="place"){const o=T(e.pieceType,e.color,e.target);if(!o)return;n.placePiece(o,e.target);const s=n.bank.findIndex(i=>i.type===e.pieceType&&i.color===e.color);s!==-1&&n.bank.splice(s,1);return}const t=n.board.pieces.find(o=>o.owner===e.color&&o.type===e.pieceType&&o.position.q===e.fromCoord.q&&o.position.r===e.fromCoord.r);t&&n.movePiece(t,e.to)}function B(n,e,t){if(e.kind==="place"){n.currentPlayer=t;const s=T(e.pieceType,e.color,e.target);if(!s||!n.placePiece(s,e.target))return;const r=n.bank.findIndex(c=>c.color===e.color&&c.type===e.pieceType);r!==-1&&n.bank.splice(r,1);return}n.currentPlayer=t;const o=n.board.pieces.find(s=>s.owner===e.color&&s.type===e.pieceType&&s.position.q===e.fromCoord.q&&s.position.r===e.fromCoord.r);o&&n.movePiece(o,e.to)}function Q(n){if(!n.currentPlayer)return;const e=n.currentPlayer==="White"?"Black":"White";J(n.board,e,n.bank)&&n.nextTurn()}class He{constructor(e){y(this,"game");y(this,"isEnabled",!1);y(this,"aiPlays","Black");y(this,"onMoveComplete",null);this.game=e}enable(){this.isEnabled=!0,console.log("AI enabled!")}disable(){this.isEnabled=!1,console.log("AI disabled!")}toggle(){return this.isEnabled=!this.isEnabled,this.isEnabled}makeMoveIfNeeded(){if(this.game.isGameOver||!this.isEnabled||!this.game.currentPlayer||!this.game.aiPlays)return;console.log("ðŸ¤– AI thinking...");const e=Ee(this.game,this.aiPlays,2);if(!e){console.log("AI: no move found");return}console.log("ðŸ¤– AI selected move:",e),Ce(this.game,e),this.onMoveComplete&&this.onMoveComplete()}}const F=1e3,Le=750,P=30,te=30,{canvas:We,renderer:C,dpr:ne}=Pe("hive-canvas",F,Le,P),u=new _;V(u.bank,F,ne,te);let g=null,w={x:0,y:0};const v=new He(u);v.onMoveComplete=()=>R();localStorage.getItem("playAgainstAI")==="true"&&(v.enable(),u.aiEnabled=!0,u.aiPlays="Black",document.getElementById("play_against_ai").textContent="AI: ON",b("ðŸ¤– Playing against AI"));let M=null;function Oe(n){if(u.aiEnabled){if(u.currentPlayer===u.aiPlays){b("ðŸ¤– AI is thinking...");return}if(n.color===u.aiPlays){b(`ðŸ¤– You cannot play ${u.aiPlays}, AI controls it!`);return}}u.currentPlayer||(u.currentPlayer=n.color,console.log(`First player: ${u.currentPlayer}`),document.getElementById("game-status").textContent=`Game started â€” ${u.currentPlayer} moves first`),g={from:"bank",bankId:n.id,type:n.type,color:n.color},console.log(`Selected from bank: ${g.color}, ${g.type}`)}function Se(n){if(u.aiEnabled&&u.currentPlayer===u.aiPlays){b("ðŸ¤– AI is thinking...");return}if(!g){const t=u.board.topPieceAt(u.board,n);if(u.aiEnabled&&t&&t.owner===u.aiPlays){b("ðŸ¤– You cannot move Black â€” AI plays Black!");return}if(t&&t.owner===u.currentPlayer){g={from:"board",ref:t},console.log(`Selected from board: ${t.owner}, ${t.type}`),u.validMoves=t.legalMoves(u.board);return}return}g.from==="bank"?Qe(n):g.from==="board"&&Ne(n),g=null,u.validMoves=[],$(C,u.board,u.bank,M,g,u.validMoves,w,P);const e=u.checkWin();e&&(u.isGameOver=!0,re(e))}function Qe(n){const e=g,t=6;if(Math.abs(n.q)>t||Math.abs(n.r)>t||Math.abs(n.q+n.r)>t){b("âŒ Outside board bounds");return}if(e.from==="bank"){const o=T(e.type,e.color,n);if(!o)return;if(u.placePiece(o,n)){const s=u.bank.findIndex(i=>i.id===e.bankId);s!==-1&&(u.bank.splice(s,1),V(u.bank,F,ne,te)),R()}}}function Ne(n){if(!g||g.from!=="board")return;const e=g.ref;u.movePiece(e,n)&&R(),g=null,u.validMoves=[],$(C,u.board,u.bank,M,g,u.validMoves,w,P)}function R(){if(u.isGameOver)return;const n=u.currentPlayer==="White"?"Black":"White";console.log(`Now turn of: ${n}`),J(u.board,n,u.bank)?(console.log(`${n} has availible moves`),u.nextTurn()):(console.log(`${n} has no availible moves`),b(`âš ï¸ ${n} has no legal moves â€” turn skipped!`)),g=null,u.validMoves=[],document.getElementById("game-status").textContent=`Next move: ${u.currentPlayer}`,v.isEnabled&&u.currentPlayer===u.aiPlays&&setTimeout(()=>v.makeMoveIfNeeded(),200)}function _e(n,e){M=n,w=e,$(C,u.board,u.bank,M,g,u.validMoves,w,P)}document.getElementById("play_against_ai").addEventListener("click",()=>{if(v.isEnabled){v.disable(),u.aiEnabled=!1,localStorage.removeItem("playAgainstAI"),document.getElementById("play_against_ai").textContent="AI: OFF",b("âŒ AI Disabled");return}localStorage.setItem("playAgainstAI","true"),b("ðŸ¤– AI Enabled â€” restarting gameâ€¦"),setTimeout(()=>{location.reload()},300)});$(C,u.board,u.bank,M,g,u.validMoves,w,P);var U;(U=document.getElementById("game-container"))==null||U.classList.remove("hidden");document.body.classList.add("ready");xe(We,u.bank,P,{onHexClick:Se,onBankClick:Oe,onHoverHex:_e});
